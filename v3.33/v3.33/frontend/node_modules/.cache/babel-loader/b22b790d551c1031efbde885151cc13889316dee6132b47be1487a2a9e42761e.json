{"ast":null,"code":"import{createSlice,createAsyncThunk}from'@reduxjs/toolkit';import jwt_decode from'jwt-decode';import{authAPI,handleApiError}from'../../api/api';// Async thunks\nexport const login=createAsyncThunk('auth/login',async(credentials,_ref)=>{let{rejectWithValue}=_ref;try{const response=await authAPI.login(credentials);const{token,user}=response.data;localStorage.setItem('token',token);return{token,user};}catch(error){return rejectWithValue(handleApiError(error));}});export const register=createAsyncThunk('auth/register',async(userData,_ref2)=>{let{rejectWithValue}=_ref2;try{const response=await authAPI.register(userData);const{token,user}=response.data;localStorage.setItem('token',token);return{token,user};}catch(error){return rejectWithValue(handleApiError(error));}});export const updatePreferences=createAsyncThunk('auth/updatePreferences',async(preferences,_ref3)=>{let{getState,rejectWithValue}=_ref3;try{const response=await authAPI.updatePreferences(preferences);return response.data.preferences;}catch(error){return rejectWithValue(handleApiError(error));}});export const updateProfile=createAsyncThunk('auth/updateProfile',async(profileData,_ref4)=>{let{getState,rejectWithValue}=_ref4;try{const response=await authAPI.updateProfile(profileData);return response.data.user;}catch(error){return rejectWithValue(handleApiError(error));}});// Helper function to check if token is valid\nconst isTokenValid=token=>{if(!token)return false;try{const decoded=jwt_decode(token);// Convert current time to seconds for comparison with JWT exp\nconst currentTime=Math.floor(Date.now()/1000);return decoded.exp>currentTime;}catch(error){return false;}};// Initial state\nconst initialState={token:localStorage.getItem('token'),user:null,isAuthenticated:isTokenValid(localStorage.getItem('token')),loading:false,error:null};// Slice\nconst authSlice=createSlice({name:'auth',initialState,reducers:{logout:state=>{localStorage.removeItem('token');state.token=null;state.user=null;state.isAuthenticated=false;},clearError:state=>{state.error=null;}},extraReducers:builder=>{builder// Login cases\n.addCase(login.pending,state=>{state.loading=true;state.error=null;}).addCase(login.fulfilled,(state,action)=>{state.loading=false;state.isAuthenticated=true;state.token=action.payload.token;state.user=action.payload.user;}).addCase(login.rejected,(state,action)=>{var _action$payload;state.loading=false;state.error=((_action$payload=action.payload)===null||_action$payload===void 0?void 0:_action$payload.message)||'Login failed';})// Register cases\n.addCase(register.pending,state=>{state.loading=true;state.error=null;}).addCase(register.fulfilled,(state,action)=>{state.loading=false;state.isAuthenticated=true;state.token=action.payload.token;state.user=action.payload.user;}).addCase(register.rejected,(state,action)=>{var _action$payload2;state.loading=false;state.error=((_action$payload2=action.payload)===null||_action$payload2===void 0?void 0:_action$payload2.message)||'Registration failed';})// Update preferences cases\n.addCase(updatePreferences.fulfilled,(state,action)=>{if(state.user){state.user.preferences=action.payload;}})// Update profile cases\n.addCase(updateProfile.fulfilled,(state,action)=>{state.user=action.payload;});}});// Actions\nexport const{logout,clearError}=authSlice.actions;// Selectors\nexport const selectIsAuthenticated=state=>state.auth.isAuthenticated;export const selectUser=state=>state.auth.user;export const selectAuthLoading=state=>state.auth.loading;export const selectAuthError=state=>state.auth.error;export default authSlice.reducer;","map":{"version":3,"names":["createSlice","createAsyncThunk","jwt_decode","authAPI","handleApiError","login","credentials","_ref","rejectWithValue","response","token","user","data","localStorage","setItem","error","register","userData","_ref2","updatePreferences","preferences","_ref3","getState","updateProfile","profileData","_ref4","isTokenValid","decoded","currentTime","Math","floor","Date","now","exp","initialState","getItem","isAuthenticated","loading","authSlice","name","reducers","logout","state","removeItem","clearError","extraReducers","builder","addCase","pending","fulfilled","action","payload","rejected","_action$payload","message","_action$payload2","actions","selectIsAuthenticated","auth","selectUser","selectAuthLoading","selectAuthError","reducer"],"sources":["C:/Users/WORK/Desktop/ProjectsNew/v3.33/frontend/src/redux/slices/authSlice.js"],"sourcesContent":["import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';\r\nimport jwt_decode from 'jwt-decode';\r\nimport { authAPI, handleApiError } from '../../api/api';\r\n\r\n// Async thunks\r\nexport const login = createAsyncThunk(\r\n  'auth/login',\r\n  async (credentials, { rejectWithValue }) => {\r\n    try {\r\n      const response = await authAPI.login(credentials);\r\n      const { token, user } = response.data;\r\n      localStorage.setItem('token', token);\r\n      return { token, user };\r\n    } catch (error) {\r\n      return rejectWithValue(handleApiError(error));\r\n    }\r\n  }\r\n);\r\n\r\nexport const register = createAsyncThunk(\r\n  'auth/register',\r\n  async (userData, { rejectWithValue }) => {\r\n    try {\r\n      const response = await authAPI.register(userData);\r\n      const { token, user } = response.data;\r\n      localStorage.setItem('token', token);\r\n      return { token, user };\r\n    } catch (error) {\r\n      return rejectWithValue(handleApiError(error));\r\n    }\r\n  }\r\n);\r\n\r\nexport const updatePreferences = createAsyncThunk(\r\n  'auth/updatePreferences',\r\n  async (preferences, { getState, rejectWithValue }) => {\r\n    try {\r\n      const response = await authAPI.updatePreferences(preferences);\r\n      return response.data.preferences;\r\n    } catch (error) {\r\n      return rejectWithValue(handleApiError(error));\r\n    }\r\n  }\r\n);\r\n\r\nexport const updateProfile = createAsyncThunk(\r\n  'auth/updateProfile',\r\n  async (profileData, { getState, rejectWithValue }) => {\r\n    try {\r\n      const response = await authAPI.updateProfile(profileData);\r\n      return response.data.user;\r\n    } catch (error) {\r\n      return rejectWithValue(handleApiError(error));\r\n    }\r\n  }\r\n);\r\n\r\n// Helper function to check if token is valid\r\nconst isTokenValid = (token) => {\r\n  if (!token) return false;\r\n  try {\r\n    const decoded = jwt_decode(token);\r\n    // Convert current time to seconds for comparison with JWT exp\r\n    const currentTime = Math.floor(Date.now() / 1000);\r\n    return decoded.exp > currentTime;\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n};\r\n\r\n// Initial state\r\nconst initialState = {\r\n  token: localStorage.getItem('token'),\r\n  user: null,\r\n  isAuthenticated: isTokenValid(localStorage.getItem('token')),\r\n  loading: false,\r\n  error: null\r\n};\r\n\r\n// Slice\r\nconst authSlice = createSlice({\r\n  name: 'auth',\r\n  initialState,\r\n  reducers: {\r\n    logout: (state) => {\r\n      localStorage.removeItem('token');\r\n      state.token = null;\r\n      state.user = null;\r\n      state.isAuthenticated = false;\r\n    },\r\n    clearError: (state) => {\r\n      state.error = null;\r\n    }\r\n  },\r\n  extraReducers: (builder) => {\r\n    builder\r\n      // Login cases\r\n      .addCase(login.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(login.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.isAuthenticated = true;\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(login.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload?.message || 'Login failed';\r\n      })\r\n      // Register cases\r\n      .addCase(register.pending, (state) => {\r\n        state.loading = true;\r\n        state.error = null;\r\n      })\r\n      .addCase(register.fulfilled, (state, action) => {\r\n        state.loading = false;\r\n        state.isAuthenticated = true;\r\n        state.token = action.payload.token;\r\n        state.user = action.payload.user;\r\n      })\r\n      .addCase(register.rejected, (state, action) => {\r\n        state.loading = false;\r\n        state.error = action.payload?.message || 'Registration failed';\r\n      })\r\n      // Update preferences cases\r\n      .addCase(updatePreferences.fulfilled, (state, action) => {\r\n        if (state.user) {\r\n          state.user.preferences = action.payload;\r\n        }\r\n      })\r\n      // Update profile cases\r\n      .addCase(updateProfile.fulfilled, (state, action) => {\r\n        state.user = action.payload;\r\n      });\r\n  }\r\n});\r\n\r\n// Actions\r\nexport const { logout, clearError } = authSlice.actions;\r\n\r\n// Selectors\r\nexport const selectIsAuthenticated = (state) => state.auth.isAuthenticated;\r\nexport const selectUser = (state) => state.auth.user;\r\nexport const selectAuthLoading = (state) => state.auth.loading;\r\nexport const selectAuthError = (state) => state.auth.error;\r\n\r\nexport default authSlice.reducer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}